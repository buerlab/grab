define(function(a,b){b.COIN=[{name:"btc",fullname:"Bitcoin",cname:"比特币"},{name:"ltc",fullname:"Litecoin",cname:"莱特币"},{name:"ppc",fullname:"Peercoin",cname:"点点币"},{name:"nmc",fullname:"Namecoin",cname:"域名币"},{name:"mec",fullname:"Megacoin",cname:"美卡币"},{name:"pts",fullname:"ProtoShares",cname:"pts"},{name:"qrk",fullname:"QuarkCoin",cname:"夸克币"},{name:"wdc",fullname:"WorldCoin",cname:"比特币"},{name:"xpm",fullname:"Primecoin",cname:"质数币"},{name:"ftc",fullname:"Feathercoin",cname:"羽毛币"},{name:"nxt",fullname:"Nxt",cname:"Nxt"},{name:"nvc",fullname:"Novacoin",cname:"Novacoin"},{name:"frc",fullname:"Freicoin",cname:"运输币"},{name:"anc",fullname:"Anoncoin",cname:"Anoncion"},{name:"cgb",fullname:"CryptogenicBullion",cname:"CryptogenicBullion"},{name:"trc",fullname:"Terracoin",cname:"Terracoin"},{name:"zet",fullname:"Zetacoin",cname:"Zetacoin"},{name:"ifc",fullname:"Infinitecoin",cname:"无限币"},{name:"bqc",fullname:"BBQCoin",cname:"烧烤币"},{name:"yac",fullname:"Yacoin",cname:"雅币"},{name:"btb",fullname:"BitBar",cname:"比特金条"},{name:"cent",fullname:"Centcoin",cname:"便士币"},{name:"cmc",fullname:"CMC",cname:"宇宙币"},{name:"dtc",fullname:"DTC",cname:"数据币"},{name:"exc",fullname:"EXC",cname:"极点币"},{name:"src",fullname:"SRC",cname:"安全币"},{name:"cnc",fullname:"CNC",cname:"中国币"},{name:"zcc",fullname:"ZCC",cname:"ZCC"},{name:"red",fullname:"RED",cname:"红币"}]}),define(function(a,b){b.USDtoCNY=6.0932}),define(function(a,b){DB={set:function(a,b){localStorage.setItem(a,b)},get:function(a){return localStorage.getItem(a)}},b.set=DB.set,b.get=DB.get}),define(function(require,exports,module){function ConvertJsonToTable(parsedJson,tableId,tableClassName,linkText){var italic="<i>{0}</i>",link=linkText?'<a href="{0}">'+linkText+"</a>":'<a href="{0}">{0}</a>',idMarkup=tableId?' id="'+tableId+'"':"",classMarkup=tableClassName?' class="'+tableClassName+'"':"",tbl='<table border="1" cellpadding="1" cellspacing="1"'+idMarkup+classMarkup+">{0}{1}</table>",th="<thead>{0}</thead>",tb="<tbody>{0}</tbody>",tr="<tr>{0}</tr>",thRow="<th>{0}</th>",tdRow="<td>{0}</td>",thCon="",tbCon="",trCon="";if(parsedJson){var isStringArray="string"==typeof parsedJson[0],headers;if(isStringArray)thCon+=thRow.format("value");else if("object"==typeof parsedJson[0])for(headers=array_keys(parsedJson[0]),i=0;i<headers.length;i++)thCon+=thRow.format(headers[i]);if(th=th.format(tr.format(thCon)),isStringArray)for(i=0;i<parsedJson.length;i++)tbCon+=tdRow.format(parsedJson[i]),trCon+=tr.format(tbCon),tbCon="";else if(headers){var urlRegExp=new RegExp(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi),javascriptRegExp=new RegExp(/(^javascript:[\s\S]*;$)/gi);for(i=0;i<parsedJson.length;i++){for(j=0;j<headers.length;j++){var value=parsedJson[i][headers[j]],isUrl=urlRegExp.test(value)||javascriptRegExp.test(value);tbCon+=isUrl?tdRow.format(link.format(value)):value?"object"==typeof value?tdRow.format(ConvertJsonToTable(eval(value.data),value.tableId,value.tableClassName,value.linkText)):tdRow.format(value):tdRow.format(italic.format(value).toUpperCase())}trCon+=tr.format(tbCon),tbCon=""}}return tb=tb.format(trCon),tbl=tbl.format(th,tb)}return null}function array_keys(a,b,c){var d="undefined"!=typeof b,e=[],f=!!c,g=!0,h="";if(a&&"object"==typeof a&&a.change_key_case)return a.keys(b,c);for(h in a)a.hasOwnProperty(h)&&(g=!0,d&&(f&&a[h]!==b?g=!1:a[h]!=b&&(g=!1)),g&&(e[e.length]=h));return e}String.prototype.format=function(){var a=arguments;return this.replace(/{(\d+)}/g,function(b,c){return"undefined"!=typeof a[c]?a[c]:"{"+c+"}"})},exports.ConvertJsonToTable=ConvertJsonToTable});var gui=require("nw.gui");define(function(a){var b=a("jquery"),c=a("./jsontotable").ConvertJsonToTable,d=a("./db");b(document).ready(function(){var a=b("iframe#okcoinFrame"),e=b("iframe#bterFrame"),f=b("iframe#bterFrameMe"),g=b("iframe#bterFrameHistory"),h=b("iframe#bterFrameMyFund"),i=b("iframe#btceFrame"),j=b("#coinmarketcap"),k={},l={};if(d){var m=d.get("historydata");m&&(l=JSON.parse(m))}var n=function(a){for(var b=[],c={"币种":"","行为":"","购买/出售价格":"","当前价格":"","价格百分比":"","降跌":"","持有量":"","购买总额":0,"目前总额":0,"所得差价":0},d=0;d<a.bterData.tradeList.length;d++)for(var e=a.bterData.tradeList[d],f=0;f<a.bterData.tradeList.length;f++){var g=a.bterData.tradeList[f];d!=f&&e&&g&&e.action==g.action&&e.moneyType==g.moneyType&&e.price==g.price&&(e.count=e.count+g.count,delete a.bterData.tradeList[f]),d!=f&&e&&g&&e.moneyType==g.moneyType&&e.action!=g.action&&"买入"==e.action&&(e.count=e.count-g.count,delete a.bterData.tradeList[f]),d!=f&&e&&g&&e.action==g.action&&e.moneyType==g.moneyType&&g.count<0&&(e.count=e.count+g.count,delete a.bterData.tradeList[f])}for(var d=0,h=a.bterData.tradeList.length;h>d;d++){var e=a.bterData.tradeList[d];if(e){var i={"币种":e.moneyType,"行为":e.action,"购买/出售价格":e.price,"当前价格":a.bterData[e.moneyType],"价格百分比":(a.bterData[e.moneyType]/e.price*100).toFixed(2)+"%","降跌":l.bterData?((a.bterData[e.moneyType]-l.bterData[e.moneyType])/l.bterData[e.moneyType]*100).toFixed(2)+"%":"","持有量":e.count.toFixed(2),"购买总额":(e.price*e.count).toFixed(2),"目前总额":(a.bterData[e.moneyType]*e.count).toFixed(2),"所得差价":((a.bterData[e.moneyType]-e.price)*e.count).toFixed(2)};b.push(i),c["购买总额"]+=e.price*e.count,c["目前总额"]+=a.bterData[e.moneyType]*e.count,c["所得差价"]+=(a.bterData[e.moneyType]-e.price)*e.count}}c["购买总额"]=c["购买总额"].toFixed(2),c["目前总额"]=c["目前总额"].toFixed(2),c["所得差价"]=c["所得差价"].toFixed(2),b.push(c);var j=[{"币种":"cny","行为":"剩余","购买/出售价格":"","当前价格":"","价格百分比":"","降跌":"","持有量":"","购买总额":"","目前总额":a.bterData.cny,"所得差价":""},{"币种":"总和","行为":"剩余","购买/出售价格":"","当前价格":"","价格百分比":"","降跌":"","持有量":"","购买总额":"","目前总额":(parseFloat(c["目前总额"])+a.bterData.cny).toFixed(2),"所得差价":""}];return b=b.concat(j)};a.load(function(){var d={},e=a.get(0).contentDocument;if(d.ltc=b("#bannerLtcLast",e).html(),d.btc=b("#bannerBtcLast",e).html(),d.allMoney=b(".nav2-center .money",e).html(),k.okcoinData=d,console.log(e.cookie),d.allMoney){a.addClass("none");var f=[{BTC:d.btc,LTC:d.ltc,"资金总额":d.allMoney}],g=c(f);b("body").append("<h2>okcoin的行情</h2>"),b("body").append(g)}else a.removeClass("none"),a.css({width:"100%",height:600}),art.dialog({content:"你还没有登录okcoin，请登录"})}),e.attr("src","http://bter.com"),i.load(function(){var a=i.get(0).contentDocument,d=6.0932,e={btc:(parseFloat(b("#last1",a).html())*d).toFixed(2),ltc:(parseFloat(b("#last14",a).html())*d).toFixed(2),nmc:(parseFloat(b("#last28",a).html())*d).toFixed(2),ppc:(parseFloat(b("#last31",a).html())*d).toFixed(2)};b("body").append("<h2>bte-e 的行情</h2>"),b("body").append(c([e],null,"table-3"))}),e.load(function(){setTimeout(function(){var a={},c=b("#bar_left_content ul",e.get(0).contentDocument).eq(1),d=b("li a span",c);d.eq(0).html()?(a.btc=parseFloat(d.eq(0).html()),a.ltc=parseFloat(d.eq(2).html()),a.bqc=parseFloat(d.eq(3).html()),a.cent=parseFloat(d.eq(5).html()),a.cnc=parseFloat(d.eq(7).html()),a.dtc=parseFloat(d.eq(8).html()),a.exc=parseFloat(d.eq(9).html()),a.ifc=parseFloat(d.eq(12).html()),a.red=parseFloat(d.eq(18).html()),a.mec=parseFloat(d.eq(13).html()),a.nmc=parseFloat(d.eq(14).html()),a.ppc=parseFloat(d.eq(15).html()),a.qrk=parseFloat(d.eq(17).html()),a.xpm=parseFloat(d.eq(23).html()),a.yac=parseFloat(d.eq(24).html()),console.log(a),k.bterData=a,f.attr("src","http://bter.com/myaccount")):e.attr("src","http://bter.com")},0)}),f.load(function(){var a=f.get(0).contentDocument,c=b("span",b("#sidebartitlewrapper",a).next().next()).eq(0).html();c?(k.bterData=k.bterData||{},k.bterData.allMoney=c,g.attr("src","http://bter.com/myaccount/myhistory")):(f.removeClass("none"),f.css({width:"100%",height:600}),art.dialog({content:"你还没有登录okcoin，请登录"}))}),g.load(function(){var a=g.get(0).contentDocument,c=b("#divMyTradeHistoryList",a).children().children().children(),d=[];if(c.length>0)for(var e=1,f=c.length;f>e;e++){var i=c.eq(e),j=b("td",i),l={time:j.eq(0).html(),action:j.eq(1).html().indexOf("买入")>0?"买入":"卖出",moneyType:j.eq(2).html().replace("/CNY","").toLowerCase(),price:parseFloat(j.eq(3).html().replace(/,/g,"")),count:parseFloat(j.eq(4).html().replace(/,/g,"")),total:parseFloat(j.eq(5).html().replace(/,/g,""))};d.push(l)}k.bterData.tradeList=d,h.attr("src"," http://bter.com/myaccount/myfunds")}),h.load(function(){var a=h.get(0).contentDocument,e=b("#homepost",a).find("table").eq(0).find("tbody tr");if(e.eq(1).find("td").eq(1).html()){h.addClass("none"),k.bterData.cny=parseFloat(e.eq(1).find("td").eq(3).html().replace(/,/g,"")),k.bterData.allMoney=parseFloat(b("#sidebartitlewrapper",a).next().next().find("span").eq(0).html().replace(/,/g,""));var f=n(k),g=c(f,"jsonTable","table-3","Download");if(b("body").append("<h2>bter 行情 </h2>"),b("body").append(g),d){if(d.get("historydata")){if(d.get("lastdata")){var j=JSON.parse(d.get("lastdata")),l=JSON.parse(d.get("historydata"));j.bterData.allMoney==k.bterData.allMoney&&l.bterData.bqc||d.set("historydata",JSON.stringify(j))}}else d.set("historydata",JSON.stringify(k));d.set("lastdata",JSON.stringify(k))}i.attr("src","https://btc-e.com/")}else h.removeClass("none"),h.css({width:"100%",height:600}),art.dialog({content:"你还没有登录bter，请登录"})}),j.attr("src","http://coinmarketcap.com/"),j.load(function(){j.get(0).contentDocument;parseFloat(b("#btc").parent().parent().find("td").eq(3).find(".price-usd").html().replace(/[$,]/g,""))})})});var http=require("http");define(function(a){function b(){this.a=1;var a=function(){console.log(this)};a()}var c,d,e,f=a("jquery"),g=a("./jsontotable").ConvertJsonToTable,h=a("./db"),i=a("./coin_type").COIN,j=a("./common"),k={},l=j.USDtoCNY;for(h&&(d=h.get("historyPrice"),d&&(e=JSON.parse(d))),c=0;c<i.length;c++)k[i[c].name]={name:i[c].name,fullname:i[c].fullname,cname:i[c].cname,okcoin_last:e&&e[i[c].name]&&e[i[c].name].okcoin,bter_last:e&&e[i[c].name]&&e[i[c].name].bter,btce_last:e&&e[i[c].name]&&e[i[c].name].btce,coinmarketcap_last:e&&e[i[c].name]&&e[i[c].name].coinmarketcap,coinmarketcapUpDown_last:e&&e[i[c].name]&&e[i[c].name].coinmarketcapUpDown};b();var m=function(a){if(a){var b=[],c=function(a,b,c){if(!a)return"";if(!b)return a;var d=((a-b)/b*100).toFixed(2),e=d>0?"green":"red";return 0==d&&(e="black"),c&&(a=(100*a).toFixed(2)+"%"),"<span style='color:"+e+"'>"+a+"("+d+"%)</span>"},d=function(a,b){var c,d,e,f=1e3;return c=f/a,d=b*c,e=d-f};for(var e in a)a.hasOwnProperty(e)&&b.push({name:a[e].name,fullname:a[e].fullname,"中文名":a[e].cname,okcoin:c(a[e].okcoin,a[e].okcoin_last),bter:c(a[e].bter,a[e].bter_last),"btc-e":c(a[e].btce,a[e].btce_last),coinmarketcap:c(a[e].coinmarketcap,a[e].coinmarketcap_last),"涨跌":c(a[e].coinmarketcapUpDown,a[e].coinmarketcapUpDown_last,1),"每搬1000元砖的利润":d(a[e].coinmarketcap,a[e].bter)});var h=g(b,"jsonTable","table-3","Download");f("#pricelist").html(h)}};f(document).ready(function(){var a=f("iframe#okcoinFrame"),b=f("iframe#bterFrame"),c=(f("iframe#bterFrameMe"),f("iframe#bterFrameHistory"),f("iframe#bterFrameMyFund"),f("iframe#btceFrame")),d=f("#coinmarketcap");a.attr("src","https://www.okcoin.com"),a.load(function(){var b=a.get(0).contentDocument;return f("#bannerLtcLast",b).html()?(k.ltc.okcoin=f("#bannerLtcLast",b).html(),k.btc.okcoin=f("#bannerBtcLast",b).html(),m(k),void 0):(setTimeout(function(){a.attr("src","https://www.okcoin.com")},1e3),void 0)}),c.attr("src","https://btc-e.com/"),c.load(function(){var b=c.get(0).contentDocument;if(!f("#last1",b).html())return setTimeout(function(){a.attr("src","http://bter.com")},1e3),void 0;if(k.btc.btce=(parseFloat(f("#last1",b).html())*l).toFixed(2),k.ltc.btce=(parseFloat(f("#last14",b).html())*l).toFixed(2),k.nmc.btce=(parseFloat(f("#last28",b).html())*l).toFixed(2),k.ppc.btce=(parseFloat(f("#last31",b).html())*l).toFixed(2),m(k),h){if(h.get("historyPrice")){if(h.get("lastPrice")){var d=JSON.parse(h.get("lastPrice")),e=JSON.parse(h.get("historyPrice"));for(var g in e)e.hasOwnProperty(g)&&(e[g].okcoin!=d[g].okcoin&&(e[g].okcoin=d[g].okcoin),d[g].okcoin_last&&e[g].okcoin_last!=d[g].okcoin_last&&(e[g].okcoin_last=d[g].okcoin_last),d[g].bter&&e[g].bter!=d[g].bter&&(e[g].bter=d[g].bter),d[g].bter_last&&e[g].bter_last!=d[g].bter_last&&(e[g].bter_last=d[g].bter_last),d[g].btce&&e[g].btce!=d[g].btce&&(e[g].btce=d[g].btce),d[g].btce_last&&e[g].btce_last!=d[g].btce_last&&(e[g].btce_last=d[g].btce_last),d[g].coinmarketcap_last&&e[g].coinmarketcap_last!=d[g].coinmarketcap_last&&(e[g].coinmarketcap_last=d[g].coinmarketcap_last),d[g].coinmarketcap&&e[g].coinmarketcap!=d[g].coinmarketcap&&(e[g].coinmarketcap=d[g].coinmarketcap),d[g].coinmarketcapUpDown&&e[g].coinmarketcapUpDown!=d[g].coinmarketcapUpDown&&(e[g].coinmarketcapUpDown=d[g].coinmarketcapUpDown),d[g].coinmarketcapUpDown_last&&e[g].coinmarketcapUpDown_last!=d[g].coinmarketcapUpDown_last&&(e[g].coinmarketcapUpDown_last=d[g].coinmarketcapUpDown_last));h.set("historyPrice",JSON.stringify(e))}}else h.set("historyPrice",JSON.stringify(k));h.set("lastPrice",JSON.stringify(k))}}),b.attr("src","http://bter.com"),b.load(function(){var a=f("#bar_left_content ul",b.get(0).contentDocument).eq(1),c=f("li a span",a);return c.eq(0).html()?(k.btc.bter=parseFloat(c.eq(0).html()),k.ltc.bter=parseFloat(c.eq(2).html()),k.bqc.bter=parseFloat(c.eq(3).html()),k.btb.bter=parseFloat(c.eq(4).html()),k.cent.bter=parseFloat(c.eq(5).html()),k.cmc.bter=parseFloat(c.eq(6).html()),k.cnc.bter=parseFloat(c.eq(7).html()),k.dtc.bter=parseFloat(c.eq(8).html()),k.exc.bter=parseFloat(c.eq(9).html()),k.frc.bter=parseFloat(c.eq(10).html()),k.ftc.bter=parseFloat(c.eq(11).html()),k.ifc.bter=parseFloat(c.eq(12).html()),k.mec.bter=parseFloat(c.eq(13).html()),k.nmc.bter=parseFloat(c.eq(14).html()),k.ppc.bter=parseFloat(c.eq(15).html()),k.pts.bter=parseFloat(c.eq(16).html()),k.qrk.bter=parseFloat(c.eq(17).html()),k.red.bter=parseFloat(c.eq(18).html()),k.xpm.bter=parseFloat(c.eq(23).html()),k.yac.bter=parseFloat(c.eq(24).html()),k.zcc.bter=parseFloat(c.eq(25).html()),m(k),void 0):(setTimeout(function(){b.attr("src","http://bter.com")},1e3),void 0)}),d.attr("src","http://coinmarketcap.com/"),d.load(function(){var a=d.get(0).contentDocument;if(0===!f("#btc").length)return setTimeout(function(){d.attr("src","http://coinmarketcap.com")},1e3),void 0;for(var b=0;b<i.length;b++){var c=i[b].name;k[c]&&f("#"+c,a).length>0&&(k[c].coinmarketcap=parseFloat(f("#"+c,a).parent().parent().find("td").eq(3).find(".price-usd").html().replace(/[$,]/g,""))*l,k[c].coinmarketcap>.01&&(k[c].coinmarketcap=k[c].coinmarketcap.toFixed(2)),k[c].coinmarketcapUpDown=parseFloat(f("#"+c,a).parent().parent().find("td").eq(5).html().replace("%",""))/100)}m(k)})})});